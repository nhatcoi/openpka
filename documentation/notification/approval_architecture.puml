@startuml Approval Architecture
!theme plain
skinparam backgroundColor #FFFFFF
skinparam package {
    BackgroundColor #E8F5E8
    BorderColor #4CAF50
    FontSize 10
}
skinparam database {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    FontSize 10
}
skinparam note {
    BackgroundColor #FFF3E0
    BorderColor #FF9800
    FontSize 9
}

title Approval Architecture: Unified + Entity-Specific\nTraining Management System

' =============================================
' LAYER 1: PRESENTATION LAYER
' =============================================
package "Presentation Layer" {
    [Unified Approval Dashboard] as Dashboard
    [Course Approval UI] as CourseUI
    [Major Approval UI] as MajorUI
    [Program Approval UI] as ProgramUI
    [Leave Request UI] as LeaveUI
    [Notification Center] as NotifCenter
    
    Dashboard --> CourseUI
    Dashboard --> MajorUI
    Dashboard --> ProgramUI
    Dashboard --> LeaveUI
    Dashboard --> NotifCenter
}

' =============================================
' LAYER 2: API LAYER
' =============================================
package "API Layer" {
    [Unified Workflow API] as WorkflowAPI
    [Course API] as CourseAPI
    [Major API] as MajorAPI
    [Program API] as ProgramAPI
    [Leave API] as LeaveAPI
    [Notification API] as NotifAPI
    
    WorkflowAPI --> CourseAPI
    WorkflowAPI --> MajorAPI
    WorkflowAPI --> ProgramAPI
    WorkflowAPI --> LeaveAPI
    WorkflowAPI --> NotifAPI
}

' =============================================
' LAYER 3: BUSINESS LOGIC LAYER
' =============================================
package "Business Logic Layer" {
    [WorkflowService] as WorkflowService
    [CourseWorkflowService] as CourseService
    [MajorWorkflowService] as MajorService
    [ProgramWorkflowService] as ProgramService
    [LeaveWorkflowService] as LeaveService
    [NotificationService] as NotifService
    
    WorkflowService --> CourseService
    WorkflowService --> MajorService
    WorkflowService --> ProgramService
    WorkflowService --> LeaveService
    WorkflowService --> NotifService
    
    note right of WorkflowService
      Generic workflow logic:
      - initiateWorkflow()
      - processApproval()
      - handleEscalation()
      - sendNotifications()
    end note
    
    note right of CourseService
      Course-specific logic:
      - Course status updates
      - Academic validation
      - Credit calculations
    end note
    
    note right of MajorService
      Major-specific logic:
      - MOET compliance
      - Curriculum validation
      - Market analysis
    end note
}

' =============================================
' LAYER 4: DATA ACCESS LAYER
' =============================================
package "Data Access Layer" {
    [WorkflowRepository] as WorkflowRepo
    [CourseRepository] as CourseRepo
    [MajorRepository] as MajorRepo
    [ProgramRepository] as ProgramRepo
    [LeaveRepository] as LeaveRepo
    [NotificationRepository] as NotifRepo
    
    WorkflowRepo --> CourseRepo
    WorkflowRepo --> MajorRepo
    WorkflowRepo --> ProgramRepo
    WorkflowRepo --> LeaveRepo
    WorkflowRepo --> NotifRepo
}

' =============================================
' LAYER 5: DATABASE LAYER
' =============================================
package "Database Layer" {
    
    package "Unified Workflow Schema (notification)" {
        database "workflow_definitions" as WFD
        database "workflow_steps" as WFS
        database "workflow_instances" as WFI
        database "approval_records" as AR
        database "notifications" as N
        database "notification_templates" as NT
        
        WFD --> WFS
        WFS --> WFI
        WFI --> AR
        WFI --> N
        NT --> N
    }
    
    package "Entity-Specific Schemas" {
        database "course_workflows" as CW
        database "course_approval_history" as CAH
        database "major_workflows" as MW
        database "program_workflows" as PW
        database "leave_request_workflows" as LRW
        database "courses" as C
        database "majors" as M
        database "programs" as P
        database "leave_requests" as LR
        
        CW --> C
        CAH --> C
        MW --> M
        PW --> P
        LRW --> LR
    }
}

' =============================================
' CONNECTIONS BETWEEN LAYERS
' =============================================
Dashboard --> WorkflowAPI
CourseUI --> CourseAPI
MajorUI --> MajorAPI
ProgramUI --> ProgramAPI
LeaveUI --> LeaveAPI

WorkflowAPI --> WorkflowService
CourseAPI --> CourseService
MajorAPI --> MajorService
ProgramAPI --> ProgramService
LeaveAPI --> LeaveService
NotifAPI --> NotifService

WorkflowService --> WorkflowRepo
CourseService --> CourseRepo
MajorService --> MajorRepo
ProgramService --> ProgramRepo
LeaveService --> LeaveRepo
NotifService --> NotifRepo

WorkflowRepo --> WFI
CourseRepo --> CW
MajorRepo --> MW
ProgramRepo --> PW
LeaveRepo --> LRW
NotifRepo --> N

' =============================================
' WORKFLOW FLOW EXAMPLE
' =============================================
note top of WorkflowService
  Example: Course Approval Flow
  
  1. User submits course → initiateWorkflow()
  2. WorkflowService creates:
     - workflow_instances record
     - course_workflows record
     - notification to approver
  3. Approver responds → processApproval()
  4. WorkflowService updates:
     - workflow_instances (next step)
     - course_workflows (status)
     - courses (status)
     - approval_records (history)
     - notifications (result)
end note

' =============================================
' BENEFITS VISUALIZATION
' =============================================
package "Benefits" {
    rectangle "Unified Benefits" as UB {
        [Single Source of Truth]
        [Consistent UX/UI]
        [Centralized Notifications]
        [Unified Dashboard]
        [Standardized API]
    }
    
    rectangle "Customization Benefits" as CB {
        [Entity-Specific Logic]
        [Performance Optimization]
        [Backward Compatibility]
        [Flexible Business Rules]
    }
    
    rectangle "Hybrid Benefits" as HB {
        [Best of Both Worlds]
        [Gradual Migration]
        [Maintainability]
        [Scalability]
    }
    
    UB --> HB
    CB --> HB
}

@enduml
